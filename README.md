# JPT-IS-NEW 課題1 実装 README

本リポジトリは、JPT Web 課題1 の**最小実装（ミニマム）**を Laravel で構築したものです。  
生徒の連絡帳提出 → 担任の既読 → 管理者のユーザー・クラス割当、という一連のフローをカバーします。

---

## 環境
- Laravel: **12.35.0**
- PHP: **8.2.12**
- DB: MySQL (XAMPP 想定)
- Node: Vite ビルド（Bootstrap）

---

## セットアップ手順

1. 依存関係インストール
   ```bash
   composer install
   npm install
   ```

2. 環境ファイルを作成しキー生成
   ```bash
   cp .env.example .env
   php artisan key:generate
   ```

3. `.env` を編集して DB を設定（例）
   ```env
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=jpt_is_new
   DB_USERNAME=root
   DB_PASSWORD=
   ```

4. マイグレーション & シーディング（初期データ投入）
   ```bash
   php artisan migrate:fresh --seed
   ```

5. Vite ビルド（初回 or 変更時）
   ```bash
   npm run build
   # 開発時は npm run dev でも可（要 php artisan serve と併用）
   ```

6. アプリ起動
   ```bash
   php artisan serve
   # http://127.0.0.1:8000
   ```

> 備考：`/` へのアクセスは `/login` にリダイレクトされるようにしています（welcome の Vite 参照エラー回避のため）。

---

## 初期ログインアカウント（ローカル開発用）
全ての初期パスワードは **`Passw0rd!`**

- 管理者  
  - `admin@example.com`
- 担任（8名）  
  - `teacher1@example.com` 〜 `teacher8@example.com`
- 生徒（30名）  
  - `student001@example.com` 〜 `student030@example.com`

---

## 主要機能

### 生徒（student）
- **マイ連絡帳一覧**（過去の提出一覧・曜日表示）
- **新規提出**  
  - 初期の対象日：**月曜は前の金曜**、それ以外は前日
  - **日付選択可**（重複禁止：同一日複数提出は不可）
- **詳細表示**  
  - 既読/未読がわかる（既読は 👍 表示）
  - **未読なら修正して再提出**が可能

### 担任（teacher）
- **提出状況ダッシュボード（/teacher/daily-logs）**
  - 日付フィルタ（過去日閲覧可）
  - KPI：対象生徒数 / 提出済 / 未提出 / 未読
  - 未提出者一覧
  - 提出一覧（本文先頭100文字表示、既読は 👍）
  - **詳細画面**で内容確認後に「既読にする」ボタン
- **生徒過去記録確認（/teacher/students）**
  - 担当クラスの生徒一覧表示
  - 特定生徒の過去記録を時系列で閲覧
  - 日付範囲フィルタ（デフォルト：過去30日）
  - 体調・メンタルスコアの色分け表示
  - 各記録の詳細表示と既読処理
- 初期ダミーデータで**過去20日分**の提出を一部生徒に付与

### 管理者（admin）
- **ユーザー一覧**
  - 割り当てクラス列（生徒：在籍 / 担任：担当）
  - 「在籍を変更」「担任割当を変更」ボタン
- **在籍割当フォーム（/admin/assign/enrollment）**
  - `?student_id=XX` で生徒プリセット
  - 現在在籍クラスを自動取得し**プリセット**＆表示
- **担任割当フォーム（/admin/assign/homeroom）**
  - `?teacher_id=YY` で担任プリセット
  - 現在担当クラスを自動取得し**プリセット**＆表示

---

## 画面導線（主なルート）
- `/login` ログイン（ui:bootstrap ベース）
- `/student/daily-logs` 生徒：一覧 → 新規提出 → 詳細/編集
- `/teacher/daily-logs` 担任：日付別ダッシュボード・一覧・詳細・既読
- `/teacher/students` 担任：担当クラス生徒一覧 → 過去記録確認
- `/teacher/students/{id}/logs` 担任：特定生徒の過去記録一覧
- `/admin/users` 管理者：ユーザー一覧（割当表示＆遷移ボタン）
- `/admin/assign/enrollment?student_id=**` 生徒在籍割当（プリセット）
- `/admin/assign/homeroom?teacher_id=**` 担任割当（プリセット）
- `/` → `/login` にリダイレクト

---

## 実装メモ（ミニマム実装のポイント）
- **曜日表示**：`2025-10-22 (水)` 形式に統一（ヘルパー or Blade ワンライナー）
- **既読表示**：👍 マークで明示
- **月曜→前金曜ロジック**：祝日考慮は今後の拡張とし、現状は単純化
- **バリデーション**：`daily_logs` は（student, target_date）重複禁止をアプリ側で担保
- **担任の過去記録確認**：担当クラス外の生徒へのアクセスを403エラーで防止
- **体調・メンタルスコア**：色分け表示（緑：良好、黄：普通、赤：要注意）
- **Vite**：welcome 由来の manifest 不一致は `/login` リダイレクトで回避

---

## 手動確認チェックリスト

### 生徒フロー
- [ ] ログイン（student001）→ **マイ連絡帳**
- [ ] **新規提出**：初期日が（平日：前日 / 月曜：前金曜）になっている
- [ ] **日付変更**して提出できる（重複日は不可）
- [ ] **詳細**で内容と **👍/未読** が見える
- [ ] **未読の記録は編集→保存**できる／既読は編集不可

### 担任フロー
- [ ] ログイン（teacher1）→ **提出一覧（担任）**
- [ ] **対象日**を切り替えると KPI と一覧/未提出が更新
- [ ] **詳細**で本文を読んでから **既読にする**
- [ ] 一覧に戻ると該当行が **👍 既読** になっている
- [ ] **生徒過去記録** → 担当クラス生徒一覧を確認
- [ ] 特定生徒を選択 → 過去記録一覧（日付フィルタ可）
- [ ] 過去記録の詳細表示と既読処理が可能

### 管理者フロー
- [ ] ログイン（admin）→ **ユーザー一覧** で割当クラスが表示
- [ ] 「在籍を変更」→ **現在在籍がプリセット** されている
- [ ] 「担任割当を変更」→ **現在担当がプリセット** されている
- [ ] 割当変更後、ユーザー一覧の割当列が更新される

---

## 既知の制約 / 今後の拡張
- **祝日考慮**（前登校日ロジック）：カレンダーAPI連携で解消予定
- **Policy/Gate** によるアクセス制御の厳密化（現在は簡易チェック）
- **テーブル索引**：`daily_logs(student_id, target_date)` のユニーク制約追加検討
- **UI**：Toasts / 入力支援（ラジオ、ヘルス/メンタルのツールチップ 等）
- **テスト**：Feature/Browser テストの追加

---

## 開発で詰まりやすいポイント（FAQ）
- **Vite manifest エラー**：`npm run build` 実行／`/`→`/login` リダイレクトで回避
- **View not found**：`resources/views/...` のパス・拡張子 `.blade.php` を再確認、`php artisan view:clear`
- **ルート/設定が反映されない**：`php artisan optimize:clear`
- **Seeder 重複**：`insertOrIgnore` を活用。`migrate:fresh --seed` が手早いです

---

## ライセンス
- 教育用途のサンプル。実務利用時はセキュリティ/権限/監査ログ等をご検討ください。