# JPT-IS-NEW 利用マニュアル

## 概要
JPT-IS-NEW は、生徒の連絡帳提出システムです。
生徒が連絡帳を提出し、担任が確認・既読処理を行い、管理者がユーザー・クラス割当を管理するWebアプリケーションです。

**最新の機能**:
- 提出カレンダー機能の追加
- CSV一括登録機能の実装
- 自動テスト機能の実装
- より実用的なテストデータの提供

---

## 目次
1. [ログイン方法](#ログイン方法)
2. [生徒向け操作マニュアル](#生徒向け操作マニュアル)
3. [担任向け操作マニュアル](#担任向け操作マニュアル)
4. [管理者向け操作マニュアル](#管理者向け操作マニュアル)
5. [主要機能](#主要機能)
6. [よくある質問](#よくある質問)
7. [トラブルシューティング](#トラブルシューティング)

---

## ログイン方法

### 1. アクセス
- ブラウザでアプリケーションのURLにアクセス
- 自動的にログイン画面にリダイレクトされます

### 2. ログイン
- **メールアドレス**: アカウントのメールアドレスを入力
- **パスワード**: `Passw0rd!` を入力
- **ログインボタン**をクリック

### 3. ロール別の初期画面
- **生徒**: マイ連絡帳一覧画面
- **担任**: 提出状況ダッシュボード
- **管理者**: ユーザー一覧画面

---

## 生徒向け操作マニュアル

### マイ連絡帳一覧画面
**URL**: `/student/daily-logs`

#### 画面の見方
- **対象日**: 連絡帳の対象日（曜日付きで表示）
- **体調**: 体調スコア（1-5）
- **メンタル**: メンタルスコア（1-5）
- **既読**: 👍既読 または 未読
- **操作**: 詳細ボタン
- **ページネーション**: 改善されたページネーション（「＞」「＜」文字が表示されない）

#### 操作方法
1. **新規提出**: 「新規提出」ボタンをクリック
2. **詳細確認**: 「詳細」ボタンで内容を確認
3. **編集**: 未読の場合は詳細画面で編集可能

### 提出カレンダー画面
**URL**: `/student/calendar`

#### 画面の見方
- **月間カレンダー**: 現在の月のカレンダー表示
- **提出済みマーク**: 赤い○で囲まれた「済」文字
- **前月・次月**: ナビゲーションボタン
- **凡例**: 提出済み・前登校日の説明

#### 操作方法
1. **カレンダー表示**: ナビゲーションの「提出カレンダー」をクリック
2. **月の移動**: 前月・次月ボタンで移動
3. **提出状況確認**: 提出済みの日は「済」マークで表示

### 新規提出画面
**URL**: `/student/daily-logs/create`

#### 入力項目
- **対象日**: 自動設定（平日は前日、月曜は前金曜）
- **体調スコア**: 1-5の数値（ラジオボタン形式、初期値3）
- **メンタルスコア**: 1-5の数値（ラジオボタン形式、初期値3）
- **本文**: 自由記述（必須）

#### 操作方法
1. 対象日を変更したい場合は日付を選択
2. 体調・メンタルスコアをラジオボタンで選択
   - 体調: 青色のボタン、「悪い」← 1 2 3 4 5 →「良い」
   - メンタル: 緑色のボタン、「悪い」← 1 2 3 4 5 →「良い」
3. 本文を入力
4. 「提出」ボタンをクリック

#### 仕様
- **ラジオボタン形式**: 直感的なラジオボタンで選択
- **初期値設定**: 体調・メンタルスコアの初期値が3に設定
- **視覚的表示**: 色分けとラベルで分かりやすく表示

#### 注意事項
- 同一日の重複提出はできません
- 未読の場合は編集・再提出が可能です

### 詳細・編集画面
**URL**: `/student/daily-logs/{id}`

#### 画面の見方
- **既読状況**: 👍既読 または 未読
- **提出内容**: 体調・メンタルスコア、本文
- **編集ボタン**: 未読時のみ表示

#### 操作方法
1. **内容確認**: 提出内容を確認
2. **編集**: 未読の場合は「編集」ボタンで修正可能
3. **保存**: 編集後は「保存」ボタンで更新

---

## 担任向け操作マニュアル

### 提出状況ダッシュボード
**URL**: `/teacher/daily-logs`

#### 画面の見方
- **日付フィルタ**: 対象日を選択して表示
- **KPI表示**: 対象生徒数、提出済、未提出、未読の数
- **未提出者リスト**: 未提出の生徒一覧
- **提出一覧**: 提出された連絡帳の一覧

#### 操作方法
1. **日付選択**: 日付フィルタで確認したい日を選択
2. **「表示」ボタン**: 選択した日の状況を表示
3. **詳細確認**: 「詳細」ボタンで内容を確認
4. **既読処理**: 「既読にする」ボタンで既読に変更

#### KPIの見方
- **対象生徒数**: 担当クラスの生徒総数
- **提出済**: 連絡帳を提出した生徒数
- **未提出**: まだ提出していない生徒数
- **未読**: 提出されているが未読の連絡帳数

### 連絡帳詳細画面（視覚的改善）
**URL**: `/teacher/daily-logs/{id}`

#### 画面の見方
- **生徒情報**: 提出者の名前・メール
- **対象日**: 連絡帳の対象日
- **スコア**: 体調・メンタルスコア
- **本文**: 生徒が記入した内容
- **既読マーク**: 👍 ✓ 既読（大きく目立つ表示）
- **既読ボタン**: 未読の場合のみ表示

#### 操作方法
1. **内容確認**: 生徒の記入内容を確認
2. **既読処理**: 「既読にする」ボタンをクリック
3. **戻る**: 一覧画面に戻る

#### 仕様
- **既読マーク**: 👍 ✓ 既読マークが大きく目立つように表示
- **視覚的強調**: 既読の記録は緑色のボーダーと背景色で強調
- **絵文字追加**: いいねマーク（👍）を追加してより分かりやすく

### 担当クラス生徒一覧
**URL**: `/teacher/students`

#### 画面の見方
- **生徒一覧**: 担当クラスの生徒一覧
- **過去記録確認**: 各生徒の過去記録を確認可能

#### 操作方法
1. **生徒選択**: 確認したい生徒の「過去記録」をクリック
2. **記録確認**: その生徒の過去の連絡帳記録を確認

### 生徒別過去記録一覧
**URL**: `/teacher/students/{studentId}/logs`

#### 画面の見方
- **日付フィルタ**: 過去30日（デフォルト）の範囲で表示
- **記録一覧**: 時系列で過去の記録を表示
- **色分け表示**: 体調・メンタルスコアの色分け

#### 操作方法
1. **日付範囲変更**: フィルタで期間を調整
2. **詳細確認**: 各記録の「詳細」ボタンで内容確認
3. **既読処理**: 未読の場合は既読に変更可能

#### 色分けの見方
- **緑**: 良好（スコア4-5）
- **黄**: 普通（スコア3）
- **赤**: 要注意（スコア1-2）

---

## 管理者向け操作マニュアル

### ユーザー一覧画面
**URL**: `/admin/users`

#### 画面の見方
- **ユーザー一覧**: 全ユーザー（管理者・担任・生徒）の一覧
- **割り当てクラス**: 生徒は在籍クラス、担任は担当クラスを表示
- **割り当て変更**: 生徒・担任の割り当て変更ボタン
- **検索機能**: 名前・メール・ロールでの検索が可能

#### 操作方法
1. **新規ユーザー作成**: 「新規ユーザー作成」ボタン
2. **CSV一括登録**: 「新規ユーザー作成（CSV一括登録）」ボタン
3. **在籍変更**: 生徒の「在籍を変更」ボタン
4. **担任割当変更**: 担任の「担任割当を変更」ボタン
5. **CSV一括割当**: 「在籍を変更（CSV一括登録）」ボタン

### 生徒在籍割当画面
**URL**: `/admin/assign/enrollment`

#### 画面の見方
- **生徒選択**: 変更対象の生徒を選択
- **現在在籍**: 現在の在籍クラスが自動表示
- **クラス選択**: 新しい在籍クラスを選択

#### 操作方法
1. **生徒選択**: ドロップダウンで生徒を選択
2. **クラス確認**: 現在の在籍クラスを確認
3. **新クラス選択**: 新しい在籍クラスを選択
4. **保存**: 「割当を保存」ボタンで変更

### 担任割当画面
**URL**: `/admin/assign/homeroom`

#### 画面の見方
- **担任選択**: 変更対象の担任を選択
- **現在担当**: 現在の担当クラスが自動表示
- **クラス選択**: 新しい担当クラスを選択

#### 操作方法
1. **担任選択**: ドロップダウンで担任を選択
2. **担当確認**: 現在の担当クラスを確認
3. **新クラス選択**: 新しい担当クラスを選択
4. **保存**: 「割当を保存」ボタンで変更

### CSV一括登録機能
**URL**: `/admin/users/import`

#### 機能概要
複数のユーザーを一度に登録できる機能です。CSVファイルからユーザー情報を読み込んで一括登録します。

#### アクセス方法
1. ユーザー一覧画面で「新規ユーザー作成（CSV一括登録）」ボタンをクリック

#### CSVファイル形式（新規ユーザー登録用）
以下の形式でCSVファイルを作成してください：

| 名前 | メール | ロール | パスワード |
|------|--------|--------|----------|
| 山田太郎 | yamada@example.com | student | Passw0rd! |

#### CSVファイルの要件
- **ヘッダー行**: 不要
- **名前**: 文字列（最大255文字）
- **メール**: メールアドレス形式、重複不可
- **ロール**: student, teacher, admin のいずれか
- **パスワード**: 8文字以上
- **文字コード**: UTF-8（Excelで保存する場合は「CSV UTF-8（コンマ区切り）」を選択）
- **区切り文字**: カンマ（,）
- **最大ファイルサイズ**: 1MB

#### 使用例
生徒40名を一括登録する場合：
```csv
山田太郎,yamada@example.com,student,Passw0rd!
佐藤花子,sato@example.com,student,Passw0rd!
鈴木一郎,suzuki@example.com,student,Passw0rd!
（以下、同様に続く...）
```

### CSV一括クラス割り当て機能（新機能）
**URL**: `/admin/assign/enrollment/import`

#### 機能概要
既存の生徒のクラス割り当てを一括変更できる機能です。CSVファイルから生徒のメールアドレスとクラス名を読み込んで、クラス割り当てを一括変更します。

#### アクセス方法
1. ユーザー一覧画面で「在籍を変更（CSV一括登録）」ボタンをクリック

#### CSVファイル形式（クラス割り当て用）
以下の形式でCSVファイルを作成してください：

| メールアドレス | クラス名 |
|--------------|---------|
| student001@example.com | 1年A組 |

#### CSVファイルの要件
- **ヘッダー行**: 不要
- **メールアドレス**: 既存の生徒のものである必要があります
- **クラス名**: 登録済みクラス名と完全一致である必要があります
- **文字コード**: UTF-8（Excelで保存する場合は「CSV UTF-8（コンマ区切り）」を選択）
- **区切り文字**: カンマ（,）
- **最大ファイルサイズ**: 1MB

#### 使用例
生徒40名のクラスを一括変更する場合：
```csv
student001@example.com,1年A組
student002@example.com,1年A組
student003@example.com,1年A組
student004@example.com,1年B組
student005@example.com,1年B組
（以下、同様に続く...）
```

#### 注意事項
- **既存の在籍を履歴として保持**: 既存の在籍は非アクティブ化され、新しい在籍がアクティブとして作成されます
- **登録済みクラス名と完全一致**: 画面に表示されている登録済みクラス一覧のクラス名と完全一致する必要があります
- **生徒のメールアドレスが必要**: CSVファイルに記載するメールアドレスは、既に登録されている生徒のものである必要があります

#### インポート結果
- 成功件数とエラー件数が表示されます
- エラーがある場合は、詳細なエラー内容が表示されます
- 全ての登録が成功するまで、データベースには反映されません（トランザクション処理）

---

## 主要機能

### 1. 提出カレンダー機能
- **目的**: 生徒の提出状況を視覚的に確認
- **機能**: 月間カレンダーで提出済みの日を「済」マークで表示
- **アクセス**: ナビゲーションの「提出カレンダー」
- **表示**: 赤い○で囲まれた「済」文字

### 2. CSV一括登録機能
- **ユーザー一括登録**: CSVファイルから複数ユーザーを一度に登録
- **クラス割り当て一括変更**: CSVファイルから生徒のクラス割り当てを一括変更
- **トランザクション処理**: 全ての登録が成功するまでデータベースに反映されない
- **エラーハンドリング**: 詳細なエラー内容の表示

### 3. 自動テスト機能
- **目的**: 手動テストの自動化
- **実行方法**: `php artisan test --testsuite=Feature`
- **内容**: 全機能の包括的テスト（50+テストケース）
- **対象**: 生徒・担任・管理者の全機能
- **テストスクリプト**: `run_tests.sh`（Linux/Mac）、`run_tests.bat`（Windows）

### 4. 検索機能
- **ユーザー検索**: 名前・メール・ロールでの検索が可能
- **検索結果表示**: 検索条件と結果件数の表示
- **リセット機能**: 検索条件のクリア

### 5. ログイン後の自動リダイレクト
- **生徒**: 自動的にマイ連絡帳画面に遷移
- **担任**: 自動的に提出状況ダッシュボードに遷移
- **管理者**: 自動的にユーザー一覧画面に遷移

---

## よくある質問

### Q1: ログインできません
**A**: 以下を確認してください
- メールアドレスが正しいか
- パスワードが `Passw0rd!` か
- データベースが初期化されているか（`php artisan migrate:fresh --seed --class=InternshipTestSeeder`）

### Q2: 提出カレンダーが表示されません
**A**: 以下を確認してください
- ナビゲーションの「提出カレンダー」をクリック
- 提出済みの記録があるか確認
- 未提出の生徒の場合は空のカレンダーが表示されます

### Q3: 体調・メンタルスコアの入力方法について
**A**: 以下の仕様になっています
- ラジオボタン形式で直感的に選択
- 初期値が3に設定
- 色分け（体調: 青、メンタル: 緑）で分かりやすく表示
- 「悪い」← 1 2 3 4 5 →「良い」のラベル表示

### Q4: 既読マークの表示について
**A**: 以下の仕様になっています
- 👍 ✓ 既読マークが大きく目立つように表示
- いいねマーク（👍）を追加
- 既読の記録は緑色のボーダーと背景色で強調

### Q5: ページネーションの表示について
**A**: 以下の仕様になっています
- カスタムページネーションビューで適切な文字を表示
- マイ連絡帳一覧とユーザー一覧で適用

### Q6: 自動テストを実行したい
**A**: 以下のコマンドで実行できます
- 全テスト: `php artisan test --testsuite=Feature`
- 個別テスト: `php artisan test tests/Feature/StudentTest.php`
- 詳細出力: `php artisan test --testsuite=Feature --verbose`
- スクリプト実行: `./run_tests.sh`（Linux/Mac）または `run_tests.bat`（Windows）

### Q7: 連絡帳を提出できません
**A**: 以下を確認してください
- 同一日に既に提出していないか
- 必須項目（体調・メンタルスコア、本文）が入力されているか
- 対象日が正しく設定されているか

### Q8: 既読にできません
**A**: 以下を確認してください
- 担任権限でログインしているか
- 担当クラスの生徒の連絡帳か
- 既に既読になっていないか

### Q9: 生徒の記録が表示されません
**A**: 以下を確認してください
- 正しいクラスに在籍しているか
- 日付フィルタの範囲内か
- データベースに記録が存在するか

### Q10: クラス割当ができません
**A**: 以下を確認してください
- 管理者権限でログインしているか
- 対象のユーザーが存在するか
- 選択したクラスが存在するか

### Q11: CSV一括登録でエラーが発生します
**A**: 以下を確認してください
- CSVファイルの形式が正しいか（カンマ区切り、UTF-8エンコーディング）
- メールアドレスが重複していないか
- ロールが正しいか（student, teacher, admin）
- パスワードが8文字以上か

### Q12: CSV一括クラス割り当てでエラーが発生します
**A**: 以下を確認してください
- メールアドレスが既存の生徒のものか
- クラス名が登録済みのものと完全一致しているか
- CSVファイルの形式が正しいか

---
