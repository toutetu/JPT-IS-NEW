# 開発者向けトラブルシューティング

## 概要
JPT-IS-NEW アプリケーションの開発・運用に関する技術的な問題と解決方法をまとめています。
開発者・システム管理者向けの詳細なトラブルシューティングガイドです。

---

## アプリケーションが起動しない
1. **依存関係の確認**
   ```bash
   composer install
   npm install
   ```

2. **環境設定の確認**
   ```bash
   cp .env.example .env
   php artisan key:generate
   ```

3. **データベースの確認**
   ```bash
   php artisan migrate:fresh --seed
   ```

4. **アプリケーションの起動**
   ```bash
   php artisan serve
   ```

### データが表示されない
1. **シーダーの実行**
   ```bash
   php artisan db:seed --class=InternshipTestSeeder
   ```

2. **キャッシュのクリア**
   ```bash
   php artisan optimize:clear
   ```

3. **ビューのクリア**
   ```bash
   php artisan view:clear
   ```

### Laravel Cloudでのテストデータ作成
Laravel Cloud環境でテストデータを再作成する場合、以下のコマンドを使用してください：

1. **データベースの完全リセットとテストデータ作成**
   ```bash
   php artisan migrate:fresh --seed --class=InternshipTestSeeder
   ```

2. **プロダクション環境での実行（強制実行）**
   ```bash
   php artisan migrate:fresh --seed --class=InternshipTestSeeder --force
   ```

3. **特定のシーダーのみ実行**
   ```bash
   php artisan db:seed --class=InternshipTestSeeder
   ```

#### 注意事項
- `migrate:fresh`コマンドは既存のデータをすべて削除します
- プロダクション環境では`--force`オプションが必要な場合があります
- テストデータには管理者・担任・生徒のアカウントと連絡帳データが含まれます

### 画面が正しく表示されない
1. **Viteビルドの実行**
   ```bash
   npm run build
   ```

2. **開発モードでの実行**
   ```bash
   npm run dev
   ```

### パフォーマンスが遅い
1. **データベースの最適化**
   - インデックスの確認
   - クエリの最適化

2. **キャッシュの活用**
   ```bash
   php artisan config:cache
   php artisan route:cache
   php artisan view:cache
   ```

### CSV一括登録でエラーが発生する場合
1. **ファイル形式の確認**
   - 文字コードがUTF-8か
   - 区切り文字がカンマ（,）か
   - ヘッダー行がないか

2. **データの確認**
   - メールアドレスの形式が正しいか
   - 重複するメールアドレスがないか
   - ロールが正しいか

3. **ファイルサイズの確認**
   - 1MB以下か
   - 行数が適切か

## 自動テスト機能

### テストの実行方法
1. **全機能の自動テスト**
   ```bash
   php artisan test --testsuite=Feature
   ```

2. **個別機能のテスト**
   ```bash
   php artisan test tests/Feature/StudentTest.php
   php artisan test tests/Feature/TeacherTest.php
   php artisan test tests/Feature/AdminTest.php
   php artisan test tests/Feature/IntegrationTest.php
   ```

3. **詳細出力でのテスト**
   ```bash
   php artisan test --testsuite=Feature --verbose
   ```

4. **テストスクリプトの実行**
   ```bash
   # Linux/Mac
   ./run_tests.sh
   
   # Windows
   run_tests.bat
   ```

### テストデータの管理
1. **テストデータの作成**
   ```bash
   php artisan migrate:fresh --seed --class=InternshipTestSeeder
   ```

2. **特定のシーダーのみ実行**
   ```bash
   php artisan db:seed --class=InternshipTestSeeder
   ```

3. **プロダクション環境での実行（強制実行）**
   ```bash
   php artisan migrate:fresh --seed --class=InternshipTestSeeder --force
   ```

### 自動テストが失敗する場合
1. **テスト環境の確認**
   ```bash
   php artisan test --testsuite=Feature --verbose
   ```

2. **データベースのリセット**
   ```bash
   php artisan migrate:fresh --seed --class=InternshipTestSeeder
   ```

3. **個別テストの実行**
   ```bash
   php artisan test tests/Feature/StudentTest.php
   php artisan test tests/Feature/TeacherTest.php
   php artisan test tests/Feature/AdminTest.php
   php artisan test tests/Feature/IntegrationTest.php
   ```

4. **テスト環境の詳細確認**
   ```bash
   php artisan test tests/Feature/AutomatedTestRunner.php
   ```

### テストデータの特徴
- **生徒パターン**: 7種類（完璧・普通・体調不良・メンタル不調・不規則・新入生・未提出）
- **データ量**: 過去50日分の平日データ
- **未提出生徒**: 初回提出テスト用の生徒を追加
- **リアルな学校環境**: 実際の学校での使用を想定

---

## 開発環境の設定

### 環境構築手順
1. **依存関係のインストール**
   ```bash
   composer install
   npm install
   ```

2. **環境ファイルの設定**
   ```bash
   cp .env.example .env
   php artisan key:generate
   ```

3. **データベースの設定**
   ```env
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=jpt_is_new
   DB_USERNAME=root
   DB_PASSWORD=
   ```

4. **データベースの初期化**
   ```bash
   php artisan migrate:fresh --seed --class=InternshipTestSeeder
   ```

5. **フロントエンドのビルド**
   ```bash
   npm run build
   # または開発モード
   npm run dev
   ```

6. **アプリケーションの起動**
   ```bash
   php artisan serve
   ```

## 開発者向けサポート

### 技術的な問題
- **ログファイルの確認**: `storage/logs/laravel.log`
- **エラーメッセージの詳細確認**: ブラウザの開発者ツールでコンソールエラーを確認
- **デバッグモード**: `.env`で`APP_DEBUG=true`に設定

### データの問題
- **データベースの直接確認**: MySQLクライアントで直接確認
- **シーダーの再実行**: `php artisan db:seed --class=InternshipTestSeeder`
- **マイグレーションの確認**: `php artisan migrate:status`

### セキュリティ
- **本番環境**: 必ずパスワードを変更
- **権限設定**: 適切な権限設定の確認
- **ログ監視**: アクセスログとエラーログの監視

### パフォーマンス最適化
- **キャッシュの活用**:
  ```bash
  php artisan config:cache
  php artisan route:cache
  php artisan view:cache
  ```

- **データベース最適化**:
  - インデックスの確認
  - クエリの最適化
  - ページングの実装

### よくある開発者向け問題
1. **ページネーションエラー**: カスタムページネーションビューの確認
2. **権限エラー**: ユーザーロールの確認
3. **データ不整合**: シーダーの再実行
4. **キャッシュ問題**: キャッシュのクリア
5. **Viteビルドエラー**: `npm run build`の再実行

---

## トラブルシューティング

### ログインできない場合
```bash
# データベースの初期化
php artisan migrate:fresh --seed --class=InternshipTestSeeder

# アプリケーションの再起動
php artisan serve
```

### データが表示されない場合
```bash
# シーダーの実行確認
php artisan db:seed --class=InternshipTestSeeder

# キャッシュのクリア
php artisan optimize:clear
```

### 自動テストの実行
```bash
# テスト環境の確認
php artisan test tests/Feature/AutomatedTestRunner.php

# 全テストの実行
php artisan test --testsuite=Feature --verbose
```